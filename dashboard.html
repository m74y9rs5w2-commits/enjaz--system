<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù‚Ù…Ù… | Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
    <style>
        :root { --primary: #1a2a6c; --gold: #c5a059; --bg: #f4f7f6; --white: #ffffff; }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #333; }

        .header { 
            background: var(--primary); color: white; padding: 12px 25px; 
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); position: sticky; top: 0; z-index: 1000; 
        }
        .header-right { font-weight: bold; font-size: 22px; }
        
        .manager-card { display: flex; align-items: center; gap: 15px; background: rgba(255, 255, 255, 0.1); padding: 6px 18px; border-radius: 50px; border: 1px solid rgba(197, 160, 89, 0.3); }
        .manager-name { font-weight: bold; color: var(--gold); font-size: 14px; }

        .container { display: grid; grid-template-columns: 1fr; gap: 20px; padding: 20px; max-width: 1400px; margin: auto; }
        @media (min-width: 992px) { .container { grid-template-columns: 2fr 1fr; } }

        .card { background: var(--white); border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-right: 5px solid var(--primary); margin-bottom: 20px; }
        .boss-card { border-right-color: var(--gold); }
        .card-header { font-weight: bold; color: var(--primary); border-bottom: 1px solid #eee; margin-bottom: 15px; padding-bottom: 10px; }

        .counter-box { display: flex; justify-content: space-around; background: linear-gradient(135deg, #1a2a6c, #c5a059); color: white; padding: 20px; border-radius: 15px; text-align: center; }
        .counter-num { font-size: 35px; font-weight: bold; display: block; }

        /* Ø§Ù„Ù…Ø­ÙØ¸Ø© */
        .stock-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 10px; }
        .stock-item { background: #f8f9fa; padding: 10px; border-radius: 8px; text-align: center; border: 1px solid #eee; }

        /* Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ */
        #alert-box { display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #2e7d32; color: white; padding: 15px 30px; border-radius: 50px; z-index: 2000; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }

        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        td, th { padding: 12px; border-bottom: 1px solid #eee; text-align: right; }
        
        select, input, button { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ddd; font-size: 14px; margin-bottom: 10px; }
        .btn-main { background: var(--primary); color: white; border: none; cursor: pointer; font-weight: bold; }
        .btn-main:disabled { background: #ccc; cursor: not-allowed; }

        .file-input-wrapper { background: #fffde7; padding: 15px; border-radius: 10px; border: 2px dashed var(--gold); text-align: center; margin-bottom: 10px; }
        
        /* Ø´ÙƒÙ„ Ø§Ù„Ù…Ø±ÙÙ‚ Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ */
        .preview-img { max-width: 100px; cursor: pointer; border-radius: 5px; border: 1px solid #ddd; }
        #modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:3000; justify-content:center; align-items:center; }
        #modal img { max-width: 90%; max-height: 90%; border-radius: 10px; }
    </style>
</head>
<body>

    <div id="alert-box">ğŸ”” Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…ÙƒØªÙ…Ù„ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª!</div>
    <div id="modal" onclick="this.style.display='none'"><img id="modal-img"></div>

    <div class="header">
        <div class="header-right">Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù‚Ù…Ù…</div>
        <div class="manager-card">
            <span class="manager-name" id="display-name">...</span>
            <button onclick="location.href='login.html'" style="background:none; border:none; color:white; cursor:pointer;">ğŸšª</button>
        </div>
    </div>

    <div class="container">
        <div class="main-side">
            <div class="card counter-box">
                <div><span class="counter-num" id="today-count">0</span><span>Ø§Ø¹ØªÙ…Ø§Ø¯Ø§Øª</span></div>
                <div><span class="counter-num" id="total-val">0</span><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø±ÙŠØ§Ù„)</span></div>
            </div>

            <div id="stockSection" class="card boss-card" style="display:none;">
                <div class="card-header">ğŸ“ˆ Ù…Ø­ÙØ¸Ø© Ø£Ø³Ù‡Ù… Ø£Ø¨Ùˆ Ø±Ø§Ø¬Ø­</div>
                <div class="stock-grid" id="stock-list"></div>
            </div>

            <div id="bossSection" class="card boss-card" style="display:none;">
                <div class="card-header">ğŸ“Š Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div>
                <table id="boss-table">
                    <thead><tr><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ù„Ø®Ø¯Ù…Ø©</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„Ù…Ø±ÙÙ‚</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead>
                    <tbody id="boss-data"></tbody>
                </table>
            </div>

            <div id="accSection" class="card" style="display:none; border-right-color:#2e7d32;">
                <div class="card-header">ğŸ¦ Ø·Ù„Ø¨Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</div>
                <div id="acc-content"></div>
            </div>

            <div id="uploadSection" class="card">
                <div class="card-header">ğŸ“¤ ØªÙ†ÙÙŠØ° Ù…Ø¹Ø§Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>
                <select id="d-list"><option>Ù‚Ø³Ù… Ø§Ù„Ø£ÙØ±Ø§Ø¯</option><option>Ù‚Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø¢Øª</option><option>Ù‚Ø³Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</option></select>
                <select id="t-list"><option>Ø¥ÙŠØµØ§Ù„ Ø´Ù‡Ø±ÙŠØ©</option><option>ØªØ¬Ø¯ÙŠØ¯ Ø£Ø¨Ø´Ø±</option><option>Ø¥ÙŠØµØ§Ù„ ØªØ¬Ø¯ÙŠØ¯</option></select>
                <input type="number" id="order-amount" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº (Ø±ÙŠØ§Ù„)">
                
                <div class="file-input-wrapper">
                    <label style="font-weight:bold; color:var(--primary); display:block; margin-bottom:5px;">âš ï¸ ÙŠØ¬Ø¨ Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ù„Ù„Ø¥Ø±Ø³Ø§Ù„:</label>
                    <input type="file" id="order-file" accept="image/*" onchange="checkFile()">
                </div>
                
                <button id="submit-btn" class="btn-main" onclick="submitNew()" disabled>Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ (Ù…ØºÙ„Ù‚ Ø­ØªÙ‰ Ø¥Ø±ÙØ§Ù‚ Ù…Ù„Ù)</button>
            </div>
        </div>

        <div class="side-side">
            <div class="card" style="text-align:center;">
                <div id="date-h" style="color:var(--gold); font-weight:bold;"></div>
                <div id="live-clock" style="font-size:20px; margin:10px 0;"></div>
            </div>
            <div class="card">
                <div class="card-header">ğŸ“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>
                <textarea id="memo-input" style="width:100%; border-radius:10px; padding:10px;" rows="3"></textarea>
                <button class="btn-main" onclick="addNote()" style="background:var(--gold); margin-top:5px;">Ø­ÙØ¸</button>
                <div id="notes-list" style="margin-top:10px;"></div>
            </div>
        </div>
    </div>

    <script>
        const role = localStorage.getItem("userRole");
        const name = localStorage.getItem("userName");

        const myStocks = [
            {n:"Ø¬Ø±ÙŠØ±", q:90}, {n:"Ø§Ù„Ø¹Ø«ÙŠÙ…", q:115}, {n:"Ø³ÙŠØ¯ÙƒÙˆ Ø±ÙŠØª", q:6},
            {n:"Ø§Ù„Ù…Ø·Ø§Ø­Ù†", q:100}, {n:"Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ Ø±ÙŠØª", q:50}, {n:"Ù…ØµØ±Ù Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ", q:3},
            {n:"stc", q:17}, {n:"Ø£Ø±Ø§Ù…ÙƒÙˆ", q:60}, {n:"Ø£Ø³Ù…Ù†Øª Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©", q:50}
        ];

        window.onload = function() {
            document.getElementById("display-name").innerText = name || "Ø£Ø¨Ùˆ Ø±Ø§Ø¬Ø­";
            updateCounter();
            loadNotes();
            
            if(role === "boss") {
                document.getElementById("bossSection").style.display = "block";
                document.getElementById("stockSection").style.display = "block";
                document.getElementById("stock-list").innerHTML = myStocks.map(s => `<div class="stock-item"><small>${s.n}</small><br><b>${s.q}</b></div>`).join('');
            }
            if(role === "accountant") {
                document.getElementById("accSection").style.display = "block";
                document.getElementById("uploadSection").style.display = "none";
                renderAccTable();
            }
            setInterval(updateClock, 1000);
        };

        function checkFile() {
            const file = document.getElementById("order-file").files[0];
            const btn = document.getElementById("submit-btn");
            if (file) {
                btn.disabled = false;
                btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† âœ…";
                btn.style.background = "#2e7d32";
            } else {
                btn.disabled = true;
            }
        }

        function submitNew() {
            const fileInput = document.getElementById("order-file");
            const reader = new FileReader();

            reader.onload = function(e) {
                localStorage.setItem("rImg", e.target.result); // Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­
                localStorage.setItem("rS", "pending");
                localStorage.setItem("rD", document.getElementById("d-list").value);
                localStorage.setItem("rT", document.getElementById("t-list").value);
                localStorage.setItem("rA", document.getElementById("order-amount").value || 0);
                alert("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!");
                location.reload();
            };
            reader.readAsDataURL(fileInput.files[0]);
        }

        function renderAccTable() {
            if(localStorage.getItem("rS") === "pending") {
                const imgData = localStorage.getItem("rImg");
                document.getElementById("acc-content").innerHTML = `
                <table>
                    <tr>
                        <td>${localStorage.getItem("rD")}</td>
                        <td>${localStorage.getItem("rA")} Ø±ÙŠØ§Ù„</td>
                        <td><img src="${imgData}" class="preview-img" onclick="showFull('${imgData}')"></td>
                        <td><button onclick="decide()" style="background:green; color:white; border:none; padding:10px; border-radius:5px; cursor:pointer;">Ø§Ø¹ØªÙ…Ø§Ø¯ âœ…</button></td>
                    </tr>
                </table>`;
            } else { document.getElementById("acc-content").innerHTML = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª."; }
        }

        function showFull(src) {
            document.getElementById("modal-img").src = src;
            document.getElementById("modal").style.display = "flex";
        }

        function decide() {
            localStorage.setItem("rS", "approved");
            let c = parseInt(localStorage.getItem("count_done") || 0);
            let t = parseFloat(localStorage.getItem("total_money") || 0);
            localStorage.setItem("count_done", c + 1);
            localStorage.setItem("total_money", t + parseFloat(localStorage.getItem("rA") || 0));
            location.reload();
        }

        function updateBoss() {
            const s = localStorage.getItem("rS") || "---";
            const img = localStorage.getItem("rImg");
            const imgHtml = img ? `<img src="${img}" class="preview-img" onclick="showFull('${img}')">` : "Ù„Ø§ ÙŠÙˆØ¬Ø¯";
            document.getElementById("boss-data").innerHTML = `
            <tr>
                <td>${localStorage.getItem("rD") || "---"}</td>
                <td>${localStorage.getItem("rT") || "---"}</td>
                <td>${localStorage.getItem("rA") || "0"} Ø±ÙŠØ§Ù„</td>
                <td>${imgHtml}</td>
                <td style="color:${s==='approved'?'green':'orange'}">${s}</td>
            </tr>`;
        }

        function updateCounter() {
            document.getElementById("today-count").innerText = localStorage.getItem("count_done") || 0;
            document.getElementById("total-val").innerText = localStorage.getItem("total_money") || 0;
            if(role === "boss") updateBoss();
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('live-clock').innerText = now.toLocaleTimeString('ar-SA');
            document.getElementById('date-h').innerText = new Intl.DateTimeFormat('ar-SA-u-ca-islamic-uma', {day:'numeric', month:'long', year:'numeric'}).format(now);
        }

        function addNote() {
            const notes = JSON.parse(localStorage.getItem("notes_"+role) || "[]");
            notes.unshift({t: document.getElementById("memo-input").value, d: new Date().toLocaleTimeString()});
            localStorage.setItem("notes_"+role, JSON.stringify(notes));
            document.getElementById("memo-input").value = "";
            loadNotes();
        }

        function loadNotes() {
            const notes = JSON.parse(localStorage.getItem("notes_"+role) || "[]");
            document.getElementById("notes-list").innerHTML = notes.map(n => `<div style="background:#eee; padding:5px; margin-bottom:5px; border-radius:5px; font-size:12px;"><b>${n.d}:</b> ${n.t}</div>`).join('');
        }
    </script>
</body>
</html>
